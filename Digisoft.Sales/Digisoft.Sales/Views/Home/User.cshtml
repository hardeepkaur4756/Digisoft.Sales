
@{
    ViewBag.Title = "User";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="admin-home">
    <div class="row">
        <div class="col-md-6">
            <div class="form">
                <div class="form-group mb-5">
                    <label class="control-label">Retrieve Information Date</label>
                    <div class="row">
                        <div class="col-md-5">
                            <input type="text" class="form-control" id="myDate" />
                        </div>
                        <div class="col-md-6">
                            <input type="submit" value="Load" id="btnLoad" class="btn btn-primary" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body" id="JobAppliedBody">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Job Applied (Monthly)
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                            </div>

                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                        </div>
                    </div>
                    <div><p></p></div>
                </div>
            </div>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body" id="ConnectsUsedBody">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Connects Used (Monthly)
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                        </div>
                    </div>
                    <div><p></p></div>
                </div>
            </div>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body" id="RepliesBody">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Replies
                            </div>
                            <div class="row no-gutters align-items-center">
                                <div class="col-auto">
                                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="progress progress-sm mr-2">
                                        <div class="progress-bar bg-info"
                                             role="progressbar"
                                             style="width: 50%;"
                                             aria-valuenow="50"
                                             aria-valuemin="0"
                                             aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                        </div>
                    </div>
                    <div><p></p></div>
                </div>
            </div>
        </div>

        <!-- Pending Requests Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body" id="JobsBody">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Jobs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-comments fa-2x text-gray-300"></i>
                        </div>
                    </div>
                    <div><p></p></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="custom-chart">
    <div class="row">
        <!-- Area Chart -->
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-2">
                    <div class="row align-items-center">
                        <div class="col-md-9">
                            <h6 class="m-0 font-weight-bold text-primary">
                                Performance Overview
                            </h6>
                        </div>
                        <div class="col-md-3"><input type="text" class="pull-right form-control" id="progressDate" placeholder="Select Year" /></div>
                    </div>
                    
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-area" id="chart-container">
                        @*<canvas id="myAreaChart"></canvas>*@
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie Chart -->
        <div class="col-xl-4 col-lg-5 d-none">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">
                        Revenue Sources
                    </h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle"
                           href="#"
                           role="button"
                           id="dropdownMenuLink"
                           data-toggle="dropdown"
                           aria-haspopup="true"
                           aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                             aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Dropdown Header:</div>
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                        </div>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-pie pt-4 pb-2">
                        <canvas id="myPieChart"></canvas>
                    </div>
                    <div class="mt-4 text-center small">
                        <span class="mr-2">
                            <i class="fas fa-circle text-primary"></i> Direct
                        </span>
                        <span class="mr-2">
                            <i class="fas fa-circle text-success"></i> Social
                        </span>
                        <span class="mr-2">
                            <i class="fas fa-circle text-info"></i> Referral
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/css/datepicker.min.css">*@
@*<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>*@
@*<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.3.0/js/bootstrap-datepicker.min.js"></script>*@
<script>
    $(document).ready(function () {
        var isFirstTime = true;
        //Retrieve Information Date
        $("#myDate").datepicker({
            autoclose: true,
            minViewMode: 1,
            format: 'mm/yyyy'
        }).on('changeDate', function (selected) {
            startDate = new Date(selected.date.valueOf());
            startDate.setDate(startDate.getDate(new Date(selected.date.valueOf())));
            $('.to').datepicker('setStartDate', startDate);
        });
        $("#myDate").val(untilHelper.GetCurrentDateMonthYearFormat);

        //Progress chart section date
        $("#progressDate").datepicker({
            autoclose: true,
            minViewMode: 2,
            format: 'yyyy'
        }).on('changeDate', function (selected) {
            var str = selected.date.toString();
            var date = new Date(str), mnth = ("0" + (date.getMonth() + 1)).slice(-2), day = ("0" + date.getDate()).slice(-2);
            _loadChart([date.getFullYear(), mnth, day].join("-"));
            isFirstTime = false;
        });
        $("#progressDate").val(untilHelper.GetCurrentDateYearFormat);

        _loadUserData();
        if (isFirstTime)
        _loadChart();
    }); 
    $("#btnLoad").click(function () {
        var date = $("#myDate").val();
        var validate = true;
        if (date == undefined || date == "") {
            validate = false;
            $("#myDate").addClass("error");
        } else {
            $("#myDate").removeClass("error");
        }
        if (validate == true) {
            _loadUserData(date);
        }
    });

    var _loadUserData = function (even) {
        if (even == undefined || even == "") {
            var d = new Date(),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;
            even = [year, month, day].join('-');
        }
        loader();
        $.ajax({
            type: "Get",
            url: "/Home/GetUserDashboardData",
            data: { "Date": even },
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (response) {
                if (response.Success) {
                    $("#JobAppliedBody .h5").html(response.data.TotalUserBiddings);
                    $("#ConnectsUsedBody .h5").html(response.data.TotalConnectsUsedByUser);
                    $("#RepliesBody .h5").html(response.data.TotalRepliesOfUser);
                    $("#JobsBody .h5").html(response.data.TotalJobsOfUser);
                    $("#JobAppliedBody p").html(response.data.AppliedJobsResult);
                    $("#ConnectsUsedBody p").html(response.data.UsedConnectsResult);
                    $("#RepliesBody p").html(response.data.RepliesResult);
                    $("#JobsBody p").html(response.data.JobsResult);
                    removeLoader();
                }
                else {
                    notificationHelper.ShowError("Some thing went wrong !");
                    removeLoader();
                }
            },
            error: function (result) {
                notificationHelper.ShowError(result.Message);
                removeLoader();
            }
        });
    };

 //GetProgressData for Bidder User start
    var _loadChart = function (even) {
        if (even == undefined || even == "") {
            var d = new Date(),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;
            even = [year, month, day].join('-');
        }
        loader();
        $.ajax({
            type: "Get",
            url: "/Home/GetProgressData",
            data: { "Date": even },
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (response) {
                if (response.Success) {
                        $('#progressChart').remove(); // this is my <canvas> element
                        $('#chart-container').append('<canvas id="progressChart"><canvas>');
                        bindChart(response);
                    removeLoader();
                }
                else {
                    notificationHelper.ShowError("Some thing went wrong !");
                    removeLoader();
                }
            },
            error: function (result) {
                notificationHelper.ShowError(result.Message);
                removeLoader();
            }
        });
    };

    var bindChart = function (reponse) {
        var config = {
            type: 'line',
            data: {
                labels: reponse.data.Labels,
                datasets: reponse.data.Datasets,
            },
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: 'Progress Chart'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false,
                },
                hover: {
                    mode: 'nearest',
                    intersect: true
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            display: true,
                            labelString: 'Month'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            stacked: true,
                            display: true,
                            labelString: 'Value'
                        }
                    }]
                }
            }
        };
        
        //initiate the new chart
        var ctx = $("#progressChart").get(0).getContext('2d');
        ctx.canvas.height = 300;  // setting height of canvas
        ctx.canvas.width = 500; // setting width of canvas
        var progressChart = new Chart(ctx, config);
    }
 //GetProgressData for Bidder User End

</script>
